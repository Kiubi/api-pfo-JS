/** 
 * Kiubi API - jQuery Client v1.0.1
 * 
 * Copyright 2018 Kiubi
 */
kiubi=window.kiubi||{};(function(c,b){var a;c.extend(b,{api_version:1,js_version:"1.0.1",base:"/api/",media:{},catalog:{},users:{},newsletter:{},prefs:{},search:{},forms:{},cms:{},blog:{},cart:{},query:function(g,m,l,h){var j=c.Deferred();var e=this;if(m.indexOf("/")!=0){m="/"+m}var f=this.base+"v"+this.api_version+m;if(f.indexOf(".json")==-1){f+=".json"}l=l||{};var i=c.ajax(c.extend({type:g,dataType:"json",data:l,url:f,headers:{"X-API":"Kiubi API jQuery Client v"+e.js_version}},h||{})).done(function(d){if(d.meta.status_code!=200){j.reject(d.meta,d.error,d.data)}else{j.resolve(d.meta,d.data)}}).fail(function(k){if(k.responseText==""){j.reject({},{},{})}else{var d=c.parseJSON(k.responseText)}j.reject(d.meta,d.error,d.data)}).always(function(d){if(!d.meta){d=c.parseJSON(d.responseText)}a=d.meta.rate_remaining});return j.promise()},post:function(e,d){c.ajaxSetup({cache:false});return this.query("POST",e,d)},get:function(e,d){c.ajaxSetup({cache:true});return this.query("GET",e,d)},put:function(e,d){c.ajaxSetup({cache:false});return this.query("PUT",e,d)},"delete":function(e,d){c.ajaxSetup({cache:false});return this.query("DELETE",e,d)},login:function(d,e){return this.put("session",{login:d,password:e})},logout:function(){return this["delete"]("session")},getFirstPage:function(d){if(d&&d.link&&d.link.first_page){return this.crawl(d.link.first_page)}else{return this.fail()}},getPreviousPage:function(d){if(d&&d.link&&d.link.previous_page){return this.crawl(d.link.previous_page)}else{return this.fail()}},getNextPage:function(d){if(d&&d.link&&d.link.next_page){return this.crawl(d.link.next_page)}else{return this.fail()}},getLastPage:function(d){if(d&&d.link&&d.link.last_page){return this.crawl(d.link.last_page)}else{return this.fail()}},getPage:function(e,d){if(e&&e.link&&e.link.first_page){return this.crawl(e.link.first_page+"&page="+parseInt(d))}else{return this.fail()}},hasNextPage:function(d){return d&&d.link&&d.link.next_page},hasPreviousPage:function(d){return d&&d.link&&d.link.previous_page},crawl:function(d){d=d.replace(this.base+"v"+this.api_version,"");return this.get(d)},fail:function(){var e=new c.Deferred();e.reject({},{},{});return e.promise()},escape:function(d){var k="\x80\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8E\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9E\x9F";var h="\u20AC\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\u017D\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\u017E\u0178";var j=d.length;var g=new Array(j);for(var f=0;f<j;f++){var e=h.indexOf(d[f]);if(e<0){g[f]=d[f]}else{g[f]=k.charAt(e)}}return window.escape(g.join(""))},getRateRemaining:function(d){if(d||a==undefined){var e=c.ajax({dataType:"json",url:this.base+"v"+this.api_version+"/rate",async:false});var f=c.parseJSON(e.responseText).meta;a=f&&f.rate_remaining}return a},api_navigator:function(f){var d=f||{};var i=false;var e=false;var g=null;var h=d.current_page||0;this.getPage=function(j){var k=c.extend(d.params||{},{page:j?j:0});return b.get(d.endpoint,k).done(function(m,l){h=m.current_page;g=m;e=!m.link.next_page}).always(function(){i=false})};this.hasNextPage=function(){return(!e)};this.getNextPage=function(){if(i||e){return b.fail()}i=true;if(!g){return this.getPage(h+1)}return b.getNextPage(g).done(function(k,j){h=k.current_page;g=k;e=!k.link.next_page}).always(function(){i=false})}}})})(jQuery,kiubi);(function(b,a){b.extend(a.blog,{getPosts:function(d){var c=d||{};return a.get("blog/posts",c)},getCategories:function(d){var c=d||{};return a.get("blog/categories",c)},getPostsByCategory:function(e,d){var c=d||{};return a.get("blog/categories/"+e+"/posts",c)},getPostsByYear:function(d,e){var c=e||{};return a.get("blog/"+d+"/posts",c)},getPostsByMonth:function(d,f,e){var c=e||{};return a.get("blog/"+d+"/"+f+"/posts",c)},getPostsByDay:function(e,g,d,f){var c=f||{};return a.get("blog/"+e+"/"+g+"/"+d+"/posts",c)},getPostsByCategoryAndYear:function(f,d,e){var c=e||{};return a.get("blog/categories/"+f+"/"+d+"/posts",c)},getPostsByCategoryAndMonth:function(g,d,f,e){var c=e||{};return a.get("blog/categories/"+g+"/"+d+"/"+f+"/posts",c)},getPostsByCategoryAndDay:function(h,e,g,d,f){var c=f||{};return a.get("blog/categories/"+h+"/"+e+"/"+g+"/"+d+"/posts",c)},getArchives:function(d){var c=d||{};return a.get("blog/archives",c)},getPost:function(c){return a.get("blog/posts/"+c)},getCaptcha:function(c){return a.get("blog/posts/"+c+"/captcha")},getComments:function(d){var c=d||{};return a.get("blog/comments",c)},getPostComments:function(e,d){var c=d||{};return a.get("blog/posts/"+e+"/comments",c)},addComment:function(i,h,d,g,f,e){var c={id:i,comment:h};if(d){c.author=d}if(g){c.email=g}if(f){c.website=f}if(e){c.captcha=e}return a.post("blog/posts/"+i+"/comments")}})})(jQuery,kiubi);(function(b,a){b.extend(a.cart,{get:function(d){var c=d||{};return a.get("cart",c)},empty:function(){return a["delete"]("cart")},addItem:function(g,f,e,d){var c=d||{};if(f){c.quantity=f}if(e){c.mode=e}return a.put("cart/items/"+g,c)},addItems:function(d,f,e){var c=e||{};c.items=d;if(f){c.mode=f}return a.put("cart/items",c)},removeItem:function(c){return a["delete"]("cart/items/"+c)},getVoucher:function(){return a.get("cart/voucher")},removeVoucher:function(){return a["delete"]("cart/voucher")},addVoucher:function(e,d){var c=d||{};c.code=e;return a.put("cart/voucher",c)},backup:function(){return a.get("cart/backup")},restore:function(c){return a.put("cart/backup",{backup:c})},getCarriers:function(){return a.get("cart/carriers")},setShipping:function(c){return a.put("cart/shipping",{carrier_id:c})},setAdresses:function(d,e){var c={billing:d};if(e){c.shipping=e;c.use_billing_as_shipping=false}else{c.use_billing_as_shipping=true}return a.put("cart/addresses",c)},getAdresses:function(){return a.get("cart/addresses")},getComment:function(){return a.get("cart/comment")},setComment:function(c){return a.put("cart/comment",{comment:c})}})})(jQuery,kiubi);(function(b,a){b.extend(a.catalog,{getProducts:function(d){var c=d||{};return a.get("catalog/products",c)},getProductsByCategory:function(e,d){var c=d||{};return a.get("catalog/categories/"+e+"/products",c)},getProductsByTags:function(d,e){var c=e||{};c.tags=d;return a.get("catalog/products",c)},getCategories:function(d){var c=d||{};return a.get("catalog/categories",c)},getTags:function(d){var c=d||{};return a.get("catalog/tags",c)},getCategoryTags:function(e,d){var c=d||{};return a.get("catalog/categories/"+e+"/tags",c)},getComments:function(d){var c=d||{};return a.get("catalog/comments",c)},getProduct:function(e,d){var c=d||{};return a.get("catalog/products/"+e,c)},getProductComments:function(e,d){var c=d||{};return a.get("catalog/products/"+e+"/comments",c)},getCaptcha:function(c){return a.get("catalog/products/"+c+"/captcha")},addComment:function(h,g,d,f,e){var c={id:h,comment:g};if(d){c.author=d}if(f){c.rate=f}if(e){c.captcha=e}return a.post("catalog/products/"+h+"/comments")},getLinkedProducts:function(e,d){var c=d||{};return a.get("catalog/products/"+e+"/linked",c)},getAlsoBoughtProducts:function(e,d){var c=d||{};return a.get("catalog/products/"+e+"/alsobought",c)},getProductImages:function(e,d){var c=d||{};return a.get("catalog/products/"+e+"/images",c)},getProductAvailability:function(c){return a.get("catalog/products/"+c+"/availability")},getVariantAvailability:function(c){return a.get("catalog/variants/"+c+"/availability")}})})(jQuery,kiubi);(function(b,a){b.extend(a.cms,{getPosts:function(d){var c=d||{};return a.get("cms/posts",c)},getPostsOfPage:function(d,e){var c=e||{};return a.get("cms/pages/"+d+"/posts",c)},getPages:function(d,e){var c=e||{};return a.get("cms/menus/"+d+"/pages",c)},getChildren:function(d,e){var c=e||{};return a.get("cms/pages/"+d+"/children",c)},getParent:function(c){return a.get("cms/pages/"+c+"/parent")}})})(jQuery,kiubi);(function(b,a){var c=0;b.extend(a.forms,{get:function(d){return a.get("forms/"+d)},submit:function(k,e){var g;var n=b(e);var m="forms/"+k+".json";var i=(b("input[type=file]",n).length>0);var f=(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData);if(i){if(!f){var h="API_target_"+(++c);var l=b("<iframe>",{id:h,name:h}).hide();n.attr({method:"POST",enctype:"multipart/form-data","accept-charset":"UTF-8",action:a.base+"v"+a.api_version+"/"+m,target:h,onsubmit:""});n.append(b("<input>",{type:"hidden",name:"force_response_mime",value:"text/plain"}));n.append(b("<input>",{type:"hidden",name:"suppress_response_code",value:"1"}));b(document.body).append(l[0]);var j=b.Deferred();l.on("load",function(){try{var o=b.parseJSON(this.contentWindow.document.body.innerText);if(typeof o.meta!="object"){b.error("data.meta is not an object")}if(o.meta.success){j.resolve(o.meta,o.data)}else{j.reject(o.meta,o.error,o.data)}}catch(q){var p={success:false,status_code:400};var d={message:"L'envoi de fichiers n'est pas support\xE9 par ce navigateur"};j.reject(p,d,{})}n.attr("action","");n.attr("target","");b(this).remove()});n[0].submit();return j.promise()}g=new FormData(n[0]);return a.query("POST",m,g,{cache:false,contentType:false,processData:false})}g=n.serialize();return a.post(m,g)},getFormCaptcha:function(d){return a.get("forms/"+d+"/captcha")},getCaptcha:function(){return a.get("forms/captcha")},submitCaptcha:function(d,e){return a.put("forms/captcha",{key:d,value:e})}})})(jQuery,kiubi);(function(b,a){b.extend(a.media,{getFiles:function(d,e){var c=e||{};return a.get("media/folders/"+d,c)},getFile:function(c){return a.get("media/files/"+c)}})})(jQuery,kiubi);(function(b,a){b.extend(a.newsletter,{subscribe:function(c){return a.post("newsletter",{newsletter:c})},unsubscribe:function(c){return a["delete"]("newsletter",{newsletter:c})}})})(jQuery,kiubi);(function(b,a){b.extend(a.prefs,{medias:function(){return a.get("prefs/medias")},site:function(){return a.get("prefs/site")},catalog:function(){return a.get("prefs/catalog")},blog:function(){return a.get("prefs/blog")}})})(jQuery,kiubi);(function(b,a){b.extend(a.search,{pages:function(d,e){var c=e||{};c.term=d;return a.get("search/cms/pages",c)},posts:function(d,e){var c=e||{};c.term=d;return a.get("search/blog/posts",c)},products:function(d,e){var c=e||{};c.term=d;return a.get("search/catalog/products",c)}})})(jQuery,kiubi);(function(b,a){b.extend(a.users,{getInfos:function(c){return a.get("users/"+c)},getAddresses:function(c){return a.get("users/"+c+"/addresses")},getOrders:function(c){return a.get("users/"+c+"/orders")},getOrder:function(c){return a.get("orders/"+c)}})})(jQuery,kiubi);