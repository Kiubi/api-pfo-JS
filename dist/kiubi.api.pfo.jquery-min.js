/** 
 * Kiubi API - jQuery Client v1.2
 * 
 * Copyright 2019 Kiubi
 */
kiubi=window.kiubi||{};(function(f,d){var e;f.extend(d,{api_version:1,js_version:"1.2",base:"/api/",blog:{},cart:{},catalog:{},cms:{},forms:{},geo:{},media:{},newsletter:{},prefs:{},search:{},users:{},query:function(o,a,b,n){var c=f.Deferred();var q=this;if(a.indexOf("/")!=0){a="/"+a}var p=this.base+"v"+this.api_version+a;if(p.indexOf(".json")==-1){p+=".json"}b=b||{};var k=f.ajax(f.extend({type:o,dataType:"json",data:b,url:p,headers:{"X-API":"Kiubi API jQuery Client v"+q.js_version}},n||{})).done(function(g){if(g.meta.status_code!=200){c.reject(g.meta,g.error,g.data)}else{c.resolve(g.meta,g.data)}}).fail(function(g){if(g.responseText==""){c.reject({},{},{})}else{var h=f.parseJSON(g.responseText)}c.reject(h.meta,h.error,h.data)}).always(function(g){if(!g.meta){g=f.parseJSON(g.responseText)}e=g.meta.rate_remaining});return c.promise()},post:function(a,b){f.ajaxSetup({cache:false});return this.query("POST",a,b)},get:function(a,b){f.ajaxSetup({cache:true});return this.query("GET",a,b)},put:function(a,b){f.ajaxSetup({cache:false});return this.query("PUT",a,b)},"delete":function(a,b){f.ajaxSetup({cache:false});return this.query("DELETE",a,b)},login:function(b,a){return this.put("session",{login:b,password:a})},logout:function(){return this["delete"]("session")},getSession:function(){return this.get("session")},getFirstPage:function(a){if(a&&a.link&&a.link.first_page){return this.crawl(a.link.first_page)}else{return this.fail()}},getPreviousPage:function(a){if(a&&a.link&&a.link.previous_page){return this.crawl(a.link.previous_page)}else{return this.fail()}},getNextPage:function(a){if(a&&a.link&&a.link.next_page){return this.crawl(a.link.next_page)}else{return this.fail()}},getLastPage:function(a){if(a&&a.link&&a.link.last_page){return this.crawl(a.link.last_page)}else{return this.fail()}},getPage:function(a,b){if(a&&a.link&&a.link.first_page){return this.crawl(a.link.first_page+"&page="+parseInt(b))}else{return this.fail()}},hasNextPage:function(a){return a&&a.link&&a.link.next_page},hasPreviousPage:function(a){return a&&a.link&&a.link.previous_page},crawl:function(a){a=a.replace(this.base+"v"+this.api_version,"");return this.get(a)},fail:function(){var a=new f.Deferred();a.reject({},{},{});return a.promise()},escape:function(n){var a="\x80\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8E\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9E\x9F";var c="\u20AC\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\u017D\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\u017E\u0178";var b=n.length;var i=new Array(b);for(var l=0;l<b;l++){var m=c.indexOf(n[l]);if(m<0){i[l]=n[l]}else{i[l]=a.charAt(m)}}return window.escape(i.join(""))},getRateRemaining:function(c){if(c||e==undefined){var b=f.ajax({dataType:"json",url:this.base+"v"+this.api_version+"/rate",async:false});var a=f.parseJSON(b.responseText).meta;e=a&&a.rate_remaining}return e},api_navigator:function(j){var l=j||{};var a=false;var k=false;var c=null;var b=l.current_page||0;this.getPage=function(h){var g=f.extend(l.params||{},{page:h?h:0});return d.get(l.endpoint,g).done(function(i,n){b=i.current_page;c=i;k=!i.link.next_page}).always(function(){a=false})};this.hasNextPage=function(){return(!k)};this.getNextPage=function(){if(a||k){return d.fail()}a=true;if(!c){return this.getPage(b+1)}return d.getNextPage(c).done(function(g,h){b=g.current_page;c=g;k=!g.link.next_page}).always(function(){a=false})}}})})(jQuery,kiubi);(function(c,d){c.extend(d.blog,{getPosts:function(a){var b=a||{};return d.get("blog/posts",b)},getCategories:function(a){var b=a||{};return d.get("blog/categories",b)},getPostsByCategory:function(a,b){var f=b||{};return d.get("blog/categories/"+a+"/posts",f)},getPostsByYear:function(b,a){var f=a||{};return d.get("blog/"+b+"/posts",f)},getPostsByMonth:function(g,a,b){var h=b||{};return d.get("blog/"+g+"/"+a+"/posts",h)},getPostsByDay:function(h,a,i,b){var j=b||{};return d.get("blog/"+h+"/"+a+"/"+i+"/posts",j)},getPostsByCategoryAndYear:function(a,g,b){var h=b||{};return d.get("blog/categories/"+a+"/"+g+"/posts",h)},getPostsByCategoryAndMonth:function(a,i,b,h){var j=h||{};return d.get("blog/categories/"+a+"/"+i+"/"+b+"/posts",j)},getPostsByCategoryAndDay:function(a,j,b,k,i){var l=i||{};return d.get("blog/categories/"+a+"/"+j+"/"+b+"/"+k+"/posts",l)},getArchives:function(){return d.get("blog/archives")},getPost:function(a){return d.get("blog/posts/"+a)},getCaptcha:function(a){return d.get("blog/posts/"+a+"/captcha")},getComments:function(a){var b=a||{};return d.get("blog/comments",b)},getPostComments:function(a,b){var f=b||{};return d.get("blog/posts/"+a+"/comments",f)},addComment:function(a,b,o,l,m,n,k){var p={id:a,comment:b};if(o){p.author=o}if(l){p.email=l}if(m){p.website=m}if(n){p.captcha=n}if(k){p.consent=k}return d.post("blog/posts/"+a+"/comments",p)}})})(jQuery,kiubi);(function(c,d){c.extend(d.catalog,{getProducts:function(a){var b=a||{};return d.get("catalog/products",b)},getProductsByCategory:function(a,b){var f=b||{};return d.get("catalog/categories/"+a+"/products",f)},getProductsByTags:function(b,a){var f=a||{};f.tags=b;return d.get("catalog/products",f)},getCategories:function(a){var b=a||{};return d.get("catalog/categories",b)},getTags:function(a){var b=a||{};return d.get("catalog/tags",b)},getCategoryTags:function(a,b){var f=b||{};return d.get("catalog/categories/"+a+"/tags",f)},getComments:function(a){var b=a||{};return d.get("catalog/comments",b)},getProduct:function(a,b){var f=b||{};return d.get("catalog/products/"+a,f)},getProductComments:function(a,b){var f=b||{};return d.get("catalog/products/"+a+"/comments",f)},getCaptcha:function(a){return d.get("catalog/products/"+a+"/captcha")},addComment:function(a,b,m,k,l,j){var n={id:a,comment:b};if(m){n.author=m}if(k){n.rate=k}if(l){n.captcha=l}if(j){n.consent=j}return d.post("catalog/products/"+a+"/comments",n)},getLinkedProducts:function(a,b){var f=b||{};return d.get("catalog/products/"+a+"/linked",f)},getAlsoBoughtProducts:function(a,b){var f=b||{};return d.get("catalog/products/"+a+"/alsobought",f)},getProductImages:function(a,b){var f=b||{};return d.get("catalog/products/"+a+"/images",f)},getProductAvailability:function(a){return d.get("catalog/products/"+a+"/availability")},getVariantAvailability:function(a){return d.get("catalog/variants/"+a+"/availability")}})})(jQuery,kiubi);(function(c,d){c.extend(d.cart,{get:function(a){var b=a||{};return d.get("cart",b)},empty:function(){return d["delete"]("cart")},addItem:function(a,b,h,i){var j=i||{};if(b){j.quantity=b}if(h){j.mode=h}return d.put("cart/items/"+a,j)},addItems:function(g,a,b){var h=b||{};h.items=g;if(a){h.mode=a}return d.put("cart/items",h)},removeItem:function(a){return d["delete"]("cart/items/"+a)},getOptions:function(a){var b=a||{};return d.get("cart/options",b)},addOption:function(a,b,g){var h=g||{};h.value=b;return d.put("cart/options/"+a,h)},removeOption:function(a){return d["delete"]("cart/options/"+a)},getVoucher:function(){return d.get("cart/voucher")},removeVoucher:function(){return d["delete"]("cart/voucher")},addVoucher:function(a,b){var f=b||{};f.code=a;return d.put("cart/voucher",f)},backup:function(){return d.get("cart/backup")},restore:function(a){return d.put("cart/backup",{backup:a})},getCarriers:function(){return d.get("cart/carriers")},testCarrierSchedule:function(a,b,g){var h={scheduled_date:b};if(g){h.scheduled_hour=g}return d.get("cart/carriers/"+a+"/schedule",h)},setShipping:function(a,b,g){var h={carrier_id:a};if(b){h.scheduled_date=b}if(g){h.scheduled_hour=g}return d.put("cart/shipping",h)},setAdresses:function(g,b,a){var h={billing:g};if(b){h.shipping=b;h.use_billing_as_shipping=false}else{h.use_billing_as_shipping=true}if(a){h.consent=a}return d.put("cart/addresses",h)},getAdresses:function(){return d.get("cart/addresses")},getComment:function(){return d.get("cart/comment")},setComment:function(a){return d.put("cart/comment",{comment:a})}})})(jQuery,kiubi);(function(c,d){c.extend(d.cms,{getPosts:function(a){var b=a||{};return d.get("cms/posts",b)},getPostsOfPage:function(b,a){var f=a||{};return d.get("cms/pages/"+b+"/posts",f)},getPages:function(b,a){var f=a||{};return d.get("cms/menus/"+b+"/pages",f)},getChildren:function(b,a){var f=a||{};return d.get("cms/pages/"+b+"/children",f)},getParent:function(a){return d.get("cms/pages/"+a+"/parent")}})})(jQuery,kiubi);(function(d,e){var f=0;d.extend(e.forms,{get:function(a){return e.get("forms/"+a)},submit:function(o,u){var s;var a=d(u);var b="forms/"+o+".json";var q=(d("input[type=file]",a).length>0);var t=(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData);if(q){if(!t){var r="API_target_"+(++f);var c=d("<iframe>",{id:r,name:r}).hide();a.attr({method:"POST",enctype:"multipart/form-data","accept-charset":"UTF-8",action:e.base+"v"+e.api_version+"/"+b,target:r,onsubmit:""});a.append(d("<input>",{type:"hidden",name:"force_response_mime",value:"text/plain"}));a.append(d("<input>",{type:"hidden",name:"suppress_response_code",value:"1"}));d(document.body).append(c[0]);var p=d.Deferred();c.on("load",function(){try{var j=d.parseJSON(this.contentWindow.document.body.innerText);if(typeof j.meta!="object"){d.error("data.meta is not an object")}if(j.meta.success){p.resolve(j.meta,j.data)}else{p.reject(j.meta,j.error,j.data)}}catch(g){var h={success:false,status_code:400};var i={message:"L'envoi de fichiers n'est pas support\xE9 par ce navigateur"};p.reject(h,i,{})}a.attr("action","");a.attr("target","");d(this).remove()});a[0].submit();return p.promise()}s=new FormData(a[0]);return e.query("POST",b,s,{cache:false,contentType:false,processData:false})}s=a.serialize();s.consent=s.consentement_ok;delete s.consentement_ok;return e.post(b,s)},getFormCaptcha:function(a){return e.get("forms/"+a+"/captcha")}})})(jQuery,kiubi);(function(c,d){c.extend(d.media,{getCountries:function(){return d.get("geo/countries")},getCountry:function(a){return d.get("geo/countries/"+a)},getRegions:function(a){return d.get("geo/countries/"+a+"/regions")},getDepartements:function(a){return d.get("geo/countries/"+a+"/departements")}})})(jQuery,kiubi);(function(c,d){c.extend(d.media,{getFiles:function(b,a){var f=a||{};return d.get("media/folders/"+b,f)},getFile:function(a){return d.get("media/files/"+a)}})})(jQuery,kiubi);(function(c,d){c.extend(d.newsletter,{subscribe:function(b,a){var f={newsletter:b};if(a){f.consent=a}return d.post("newsletter",f)},unsubscribe:function(a){return d["delete"]("newsletter",{newsletter:a})}})})(jQuery,kiubi);(function(c,d){c.extend(d.prefs,{medias:function(){return d.get("prefs/medias")},site:function(){return d.get("prefs/site")},catalog:function(){return d.get("prefs/catalog")},blog:function(){return d.get("prefs/blog")}})})(jQuery,kiubi);(function(c,d){c.extend(d.search,{pages:function(b,a){var f=a||{};f.term=b;return d.get("search/cms/pages",f)},posts:function(b,a){var f=a||{};f.term=b;return d.get("search/blog/posts",f)},products:function(b,a){var f=a||{};f.term=b;return d.get("search/catalog/products",f)}})})(jQuery,kiubi);(function(c,d){c.extend(d.users,{getInfos:function(a){return d.get("users/"+a)},getAddresses:function(a){return d.get("users/"+a+"/addresses")},getOrders:function(a){return d.get("users/"+a+"/orders")},getOrder:function(a,b){var f=b||{};return d.get("orders/"+a,f)}})})(jQuery,kiubi);